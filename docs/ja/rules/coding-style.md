# コーディングスタイル

## イミュータビリティ (重要)

常に新しいオブジェクトを作成し、既存のものを変更しないこと:

```
// 擬似コード
誤り:  modify(original, field, value) → originalを直接変更
正解: update(original, field, value) → 変更を加えた新しいコピーを返す
```

理由: イミュータブルなデータは隠れた副作用を防ぎ、デバッグを容易にし、安全な並行処理を可能にします。

## ファイル構成

少数の大きなファイルより多数の小さなファイル:
- 高凝集、低結合
- 標準200-400行、最大800行
- 大きなモジュールからユーティリティを抽出
- 型ではなく機能/ドメインで整理

## エラー処理

常に包括的にエラーを処理すること:
- すべてのレベルで明示的にエラーを処理
- UIに面したコードではユーザーフレンドリーなエラーメッセージを提供
- サーバーサイドでは詳細なエラーコンテキストをログに記録
- エラーを黙って飲み込まない

## 入力検証

システム境界で常に検証すること:
- 処理前にすべてのユーザー入力を検証
- 利用可能な場合はスキーマベースの検証を使用
- 明確なエラーメッセージで早期に失敗
- 外部データ(APIレスポンス、ユーザー入力、ファイルコンテンツ)を決して信頼しない

## コード品質チェックリスト

作業を完了とマークする前に:
- [ ] コードが読みやすく、適切な命名がされている
- [ ] 関数が小さい(<50行)
- [ ] ファイルが焦点を絞っている(<800行)
- [ ] 深いネストがない(>4レベル)
- [ ] 適切なエラー処理
- [ ] ハードコードされた値がない(定数または設定を使用)
- [ ] ミューテーションがない(イミュータブルパターンを使用)
